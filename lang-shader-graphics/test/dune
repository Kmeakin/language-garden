(cram
  (package lang-shader-graphics)
  (deps %{bin:shader-graphics}))

(rule
  (with-stdout-to basic.glsl.out
    (run %{bin:shader-graphics} compile --scene=basic)))

(rule
  (alias runtest)
  (package lang-shader-graphics)
  (action (diff basic.glsl basic.glsl.out)))

(rule
  (with-stdout-to basic.png.out
    (pipe-stdout
      (run %{bin:shader-graphics} render --scene=basic)
      (run pnmtopng))))

(rule
  (alias runtest)
  (package lang-shader-graphics)
  (action (cmp basic.png basic.png.out)))


(rule
  (with-stdout-to readme.glsl.out
    (run %{bin:shader-graphics} compile --scene=readme)))

(rule
  (alias runtest)
  (package lang-shader-graphics)
  (action (diff readme.glsl readme.glsl.out)))

(rule
  (with-stdout-to readme.png.out
    (pipe-stdout
      (run %{bin:shader-graphics} render --scene=readme)
      (run pnmtopng))))

(rule
  (alias runtest)
  (package lang-shader-graphics)
  (action (cmp readme.png readme.png.out)))
