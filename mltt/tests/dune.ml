let print_stanza name =
  print_string [%string {|

; %{name}

(rule
  (alias "%{name}.elab")
  (deps ../main.exe)
  (action
    (with-stdin-from %{name}
      (with-stdout-to %{name}.elab.stdout.exp
        (run mltt elab)))))

(rule
  (alias "%{name}.norm")
  (deps ../main.exe)
  (action
    (with-stdin-from %{name}
      (with-stdout-to %{name}.norm.stdout.exp
        (run mltt norm)))))

(rule
  (alias runtest)
  (deps (alias %{name}.elab))
  (action
    (diff expected/%{name}.elab.stdout %{name}.elab.stdout.exp)))

(rule
  (alias runtest)
  (deps (alias %{name}.norm))
  (action
    (diff expected/%{name}.norm.stdout %{name}.norm.stdout.exp)))
|}]


let () =
  let args = Array.sub Sys.argv 1 (Array.length Sys.argv - 1) in

  print_endline "; @generated by `dune build --auto-promote`";

  Array.iter print_stanza args
